<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Download Manager</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: #f5f5f5;
      color: #333;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    header {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    h1 {
      font-size: 24px;
      margin-bottom: 10px;
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }

    .stat-card {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .stat-label {
      font-size: 14px;
      color: #666;
      margin-bottom: 5px;
    }

    .stat-value {
      font-size: 28px;
      font-weight: bold;
      color: #2563eb;
    }

    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      border-bottom: 2px solid #e5e7eb;
    }

    .tab {
      padding: 10px 20px;
      background: none;
      border: none;
      cursor: pointer;
      font-size: 16px;
      color: #666;
      border-bottom: 2px solid transparent;
      margin-bottom: -2px;
    }

    .tab.active {
      color: #2563eb;
      border-bottom-color: #2563eb;
    }

    .content {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .file-list {
      list-style: none;
    }

    .file-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      border-bottom: 1px solid #e5e7eb;
    }

    .file-item:last-child {
      border-bottom: none;
    }

    .file-info {
      flex: 1;
    }

    .file-name {
      font-weight: 500;
      margin-bottom: 4px;
    }

    .file-meta {
      font-size: 12px;
      color: #666;
    }

    .file-actions button {
      padding: 6px 12px;
      background: #ef4444;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
    }

    .file-actions button:hover {
      background: #dc2626;
    }

    .duplicate-group {
      background: #fef2f2;
      border: 1px solid #fecaca;
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 8px;
    }

    .duplicate-header {
      font-weight: bold;
      margin-bottom: 10px;
      color: #991b1b;
    }

    .history-item {
      display: flex;
      justify-content: space-between;
      padding: 10px;
      border-bottom: 1px solid #e5e7eb;
    }

    .category-filter {
      margin-bottom: 15px;
    }

    .category-filter select {
      padding: 8px 12px;
      border: 1px solid #d1d5db;
      border-radius: 4px;
      font-size: 14px;
    }

    .loading {
      text-align: center;
      padding: 40px;
      color: #666;
    }

    .empty-state {
      text-align: center;
      padding: 40px;
      color: #666;
    }

    .badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 500;
      text-transform: uppercase;
    }

    .badge-images { background: #dbeafe; color: #1e40af; }
    .badge-documents { background: #fef3c7; color: #92400e; }
    .badge-videos { background: #fce7f3; color: #831843; }
    .badge-audio { background: #e0e7ff; color: #3730a3; }
    .badge-archives { background: #d1fae5; color: #065f46; }
    .badge-code { background: #f3e8ff; color: #5b21b6; }
    .badge-other { background: #e5e7eb; color: #374151; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>ðŸ“¥ Download Manager</h1>
      <p id="status">Loading...</p>
    </header>

    <div class="stats" id="stats">
      <!-- Stats cards will be inserted here -->
    </div>

    <div class="tabs">
      <button class="tab active" data-tab="files">Files</button>
      <button class="tab" data-tab="duplicates">Duplicates</button>
      <button class="tab" data-tab="history">History</button>
    </div>

    <div class="content">
      <div id="files-tab" class="tab-content">
        <div class="category-filter">
          <label>Filter by category: </label>
          <select id="category-select">
            <option value="all">All Categories</option>
          </select>
        </div>
        <ul class="file-list" id="file-list">
          <li class="loading">Loading files...</li>
        </ul>
      </div>

      <div id="duplicates-tab" class="tab-content" style="display: none;">
        <div id="duplicates-list">
          <div class="loading">Scanning for duplicates...</div>
        </div>
      </div>

      <div id="history-tab" class="tab-content" style="display: none;">
        <div id="history-list">
          <div class="loading">Loading history...</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const API_URL = '';
    let currentTab = 'files';
    let currentCategory = 'all';

    // Tab switching
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        const tabName = tab.dataset.tab;
        switchTab(tabName);
      });
    });

    function switchTab(tabName) {
      currentTab = tabName;

      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

      document.querySelectorAll('.tab-content').forEach(content => {
        content.style.display = 'none';
      });
      document.getElementById(`${tabName}-tab`).style.display = 'block';

      if (tabName === 'files') loadFiles();
      else if (tabName === 'duplicates') loadDuplicates();
      else if (tabName === 'history') loadHistory();
    }

    // Load status and stats
    async function loadStatus() {
      try {
        const res = await fetch(`${API_URL}/api/status`);
        const data = await res.json();

        document.getElementById('status').textContent =
          `Watching: ${data.watchPath} â†’ ${data.sortedPath}`;

        const statsHTML = `
          <div class="stat-card">
            <div class="stat-label">Total Sorted</div>
            <div class="stat-value">${data.stats.totalSorted}</div>
          </div>
          ${Object.entries(data.stats.byCategory).map(([cat, count]) => `
            <div class="stat-card">
              <div class="stat-label">${cat}</div>
              <div class="stat-value">${count}</div>
            </div>
          `).join('')}
        `;

        document.getElementById('stats').innerHTML = statsHTML;
      } catch (error) {
        console.error('Error loading status:', error);
      }
    }

    // Load categories
    async function loadCategories() {
      try {
        const res = await fetch(`${API_URL}/api/categories`);
        const data = await res.json();

        const select = document.getElementById('category-select');
        data.categories.forEach(cat => {
          const option = document.createElement('option');
          option.value = cat;
          option.textContent = cat;
          select.appendChild(option);
        });

        select.addEventListener('change', (e) => {
          currentCategory = e.target.value;
          loadFiles();
        });
      } catch (error) {
        console.error('Error loading categories:', error);
      }
    }

    // Load files
    async function loadFiles() {
      try {
        const res = await fetch(`${API_URL}/api/files?category=${currentCategory}`);
        const data = await res.json();

        const fileList = document.getElementById('file-list');

        if (data.files.length === 0) {
          fileList.innerHTML = '<li class="empty-state">No files sorted yet</li>';
          return;
        }

        fileList.innerHTML = data.files.map(file => `
          <li class="file-item">
            <div class="file-info">
              <div class="file-name">
                <span class="badge badge-${file.category}">${file.category}</span>
                ${file.name}
              </div>
              <div class="file-meta">
                ${formatBytes(file.size)} â€¢ ${new Date(file.modified).toLocaleString()}
              </div>
            </div>
            <div class="file-actions">
              <button onclick="deleteFile('${file.category}', '${file.name}')">Delete</button>
            </div>
          </li>
        `).join('');
      } catch (error) {
        console.error('Error loading files:', error);
      }
    }

    // Load duplicates
    async function loadDuplicates() {
      try {
        const res = await fetch(`${API_URL}/api/duplicates`);
        const data = await res.json();

        const dupList = document.getElementById('duplicates-list');

        if (data.duplicates.length === 0) {
          dupList.innerHTML = '<div class="empty-state">No duplicates found</div>';
          return;
        }

        dupList.innerHTML = data.duplicates.map(dup => `
          <div class="duplicate-group">
            <div class="duplicate-header">
              ${dup.count} duplicates â€¢ ${formatBytes(dup.size)} each â€¢ Total waste: ${formatBytes(dup.size * (dup.count - 1))}
            </div>
            <ul class="file-list">
              ${dup.files.map(file => {
                const parts = file.split('/');
                const filename = parts[parts.length - 1];
                const category = parts[parts.length - 2];
                return `
                  <li class="file-item">
                    <div class="file-info">
                      <div class="file-name">${file}</div>
                    </div>
                    <div class="file-actions">
                      <button onclick="deleteFile('${category}', '${filename}')">Delete</button>
                    </div>
                  </li>
                `;
              }).join('')}
            </ul>
          </div>
        `).join('');
      } catch (error) {
        console.error('Error loading duplicates:', error);
      }
    }

    // Load history
    async function loadHistory() {
      try {
        const res = await fetch(`${API_URL}/api/history`);
        const data = await res.json();

        const histList = document.getElementById('history-list');

        if (data.history.length === 0) {
          histList.innerHTML = '<div class="empty-state">No history yet</div>';
          return;
        }

        histList.innerHTML = data.history.map(entry => `
          <div class="history-item">
            <div>
              <div><strong>${entry.filename}</strong> â†’ <span class="badge badge-${entry.category}">${entry.category}</span></div>
              <div class="file-meta">${formatBytes(entry.size)} â€¢ ${new Date(entry.timestamp).toLocaleString()}</div>
            </div>
          </div>
        `).join('');
      } catch (error) {
        console.error('Error loading history:', error);
      }
    }

    // Delete file
    async function deleteFile(category, filename) {
      if (!confirm(`Delete ${filename}?`)) return;

      try {
        const res = await fetch(`${API_URL}/api/files/${category}/${encodeURIComponent(filename)}`, {
          method: 'DELETE'
        });

        if (res.ok) {
          loadFiles();
          loadStatus();
        } else {
          alert('Error deleting file');
        }
      } catch (error) {
        console.error('Error deleting file:', error);
        alert('Error deleting file');
      }
    }

    // Format bytes
    function formatBytes(bytes) {
      if (bytes === 0) return '0 Bytes';
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
    }

    // Initial load
    loadStatus();
    loadCategories();
    loadFiles();

    // Refresh every 5 seconds
    setInterval(() => {
      loadStatus();
      if (currentTab === 'files') loadFiles();
    }, 5000);
  </script>
</body>
</html>
